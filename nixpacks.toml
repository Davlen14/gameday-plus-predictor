# Tell Nixpacks to install Python, Node.js, and essential system build tools
[phases.setup]
nixPkgs = [
    "python311", 
    "python311Packages.pip", 
    "nodejs_22", 
    "pkg-config", 
    "openssl"
]

# Define the installation commands for both environments
[phases.install]
cmds = [
    "ls -la /root/.nix-profile/bin/ | grep -E '(pip|python)'",
    "which python3 || echo 'python3 not found'", 
    "which pip || echo 'pip not found'",
    "/root/.nix-profile/bin/pip install --upgrade pip",
    "/root/.nix-profile/bin/pip install -r requirements.txt",
    "npm --prefix frontend install"
]

# Define the build command for the React frontend
[phases.build]
cmds = ["npm --prefix frontend run build"]

# Define the final start command for the Python backend
[start]
cmd = "gunicorn app:app --bind 0.0.0.0:$PORT"
